import{az as e,r as a,X as s,ag as r,y as l,z as o,A as u,P as t,H as n,a5 as i,L as d,C as p,G as m,u as c}from"./vue-vendor-d5869c7e.js";import{_ as f,u as _,g}from"./index-294d5dea.js";import{a as v}from"./utils-9074b6ef.js";import{v as y,n as w,E as k}from"./element-plus-34fa3ae3.js";const b={class:"login-container"},x={class:"register-link"},V=f({__name:"Login",setup(f){const V=e(),h=_(),j=a(null),q=a(null),C=a(!1),L=a(!1),U=s({username:"",password:""}),$={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},z=()=>{L.value=!L.value},I=()=>{q.value?.focus()},K=async()=>{j.value&&await j.value.validate((async e=>{if(e){C.value=!0;try{k.info("正在发送登录请求...");const e=await v.post(`${g()}/api/login`,{username:U.username,password:U.password});h.login({username:e.data.username,access_token:e.data.access_token,user_id:e.data.user_id,role:e.data.role}),k.success("登录成功"),V.push("/")}catch(a){if(a.response){const e=a.response.data?.msg||a.response.statusText||"服务器错误";k.error(`登录失败: ${e}`)}else a.request?k.error("服务器连接失败，请检查后端服务是否运行"):k.error(`请求出错: ${a.message}`)}finally{C.value=!1}}}))};return(e,a)=>{const s=r("el-input"),f=r("el-form-item"),_=r("el-icon"),g=r("el-button"),v=r("el-form"),k=r("router-link");return l(),o("div",b,[a[5]||(a[5]=u("h2",null,"登录",-1)),t(v,{model:U,rules:$,ref_key:"loginFormRef",ref:j,onKeyup:i(K,["enter"])},{default:n((()=>[t(f,{prop:"username"},{default:n((()=>[t(s,{modelValue:U.username,"onUpdate:modelValue":a[0]||(a[0]=e=>U.username=e),placeholder:"用户名","prefix-icon":"User",onKeyup:i(I,["enter"])},null,8,["modelValue"])])),_:1}),t(f,{prop:"password"},{default:n((()=>[t(s,{modelValue:U.password,"onUpdate:modelValue":a[1]||(a[1]=e=>U.password=e),type:L.value?"text":"password",placeholder:"密码","prefix-icon":"Lock",ref_key:"passwordInput",ref:q},{suffix:n((()=>[t(_,{class:p(["password-toggle",{"is-visible":L.value}]),onClick:z},{default:n((()=>[L.value?(l(),m(c(y),{key:0})):(l(),m(c(w),{key:1}))])),_:1},8,["class"])])),_:1},8,["modelValue","type"])])),_:1}),t(f,null,{default:n((()=>[t(g,{type:"primary",onClick:K,loading:C.value,class:"submit-btn"},{default:n((()=>a[2]||(a[2]=[d("登录")]))),_:1,__:[2]},8,["loading"])])),_:1})])),_:1},8,["model"]),u("div",x,[a[4]||(a[4]=d(" 还没有账号？")),t(k,{to:"/register"},{default:n((()=>a[3]||(a[3]=[d("立即注册")]))),_:1,__:[3]})])])}}},[["__scopeId","data-v-7fc1bbe9"]]);export{V as default};
