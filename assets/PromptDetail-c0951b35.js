import{aC as e,az as a,r as t,c as s,k as r,f as l,ag as i,y as o,z as n,G as u,P as c,H as d,A as p,M as v,u as m,C as g,L as f}from"./vue-vendor-d5869c7e.js";import{a as y}from"./utils-9074b6ef.js";import{E as k,k as S}from"./element-plus-34fa3ae3.js";import{_ as h,u as I,g as _}from"./index-294d5dea.js";const w={class:"prompt-detail"},N={key:1,class:"not-found"},J={key:2,class:"prompt-content"},O={class:"prompt-header"},$={class:"title-container"},x={class:"prompt-meta"},P={class:"author"},z={class:"created-at"},C={class:"content-box"},L={class:"prompt-actions"},b={class:"like-text"},j={class:"like-count"},A=h({__name:"PromptDetail",setup(h){const A=e(),W=a(),B=I(),D=t(null),M=t(!0),E=t(!1);t(!0);const G=s((()=>B.isLoggedIn)),H=()=>{if(!G.value||!D.value)return;const e=`user_${B.userId}_user-liked-prompts`,a=JSON.parse(localStorage.getItem(e)||"[]");E.value=a.includes(D.value.id)},T=async()=>{M.value=!0;try{const a=A.params.id,t=JSON.parse(localStorage.getItem("dev-prompts")||"[]").find((e=>e.id==a));if(t)D.value=t;else try{const e=await y.get(`${_()}/api/prompts/${a}`);D.value=e.data}catch(e){D.value=null,k.error("未找到该Prompt")}D.value&&B.isLoggedIn&&H()}catch(e){k.error("获取Prompt详情失败，请稍后重试"),D.value=null}finally{M.value=!1}},q=()=>{navigator.clipboard.writeText(D.value.content).then((()=>{k.success("已复制到剪贴板")})).catch((e=>{k.error("复制失败，请手动复制")}))},F=async(e,a)=>{if(D.value.id.toString().startsWith("dev-")){const t=JSON.parse(localStorage.getItem("dev-prompts")||"[]"),s=t.findIndex((e=>e.id===D.value.id));return-1===s?void k.error("未找到该Prompt"):(t[s].likes+=1,D.value.likes+=1,localStorage.setItem("dev-prompts",JSON.stringify(t)),e.includes(D.value.id)||(e.push(D.value.id),localStorage.setItem(a,JSON.stringify(e))),E.value=!0,void k.success("点赞成功"))}try{const t=await y.post(`${_()}/api/prompts/${D.value.id}/like`,{},{headers:{Authorization:`Bearer ${B.token}`}});D.value.likes=t.data.likes,e.includes(D.value.id)||(e.push(D.value.id),localStorage.setItem(a,JSON.stringify(e))),E.value=!0,k.success("点赞成功")}catch(t){k.error("点赞失败，请稍后重试")}},K=async(e,a)=>{if(D.value.id.toString().startsWith("dev-")){const t=JSON.parse(localStorage.getItem("dev-prompts")||"[]"),s=t.findIndex((e=>e.id===D.value.id));if(-1===s)return void k.error("未找到该Prompt");t[s].likes=Math.max(0,t[s].likes-1),D.value.likes=t[s].likes,localStorage.setItem("dev-prompts",JSON.stringify(t));const r=e.filter((e=>e!==D.value.id));return localStorage.setItem(a,JSON.stringify(r)),E.value=!1,void k.success("已取消点赞")}try{const t=await y.delete(`${_()}/api/prompts/${D.value.id}/like`,{headers:{Authorization:`Bearer ${B.token}`}});D.value.likes=t.data.likes;const s=e.filter((e=>e!==D.value.id));localStorage.setItem(a,JSON.stringify(s)),E.value=!1,k.success("已取消点赞")}catch(t){k.error("取消点赞失败，请稍后重试")}};s((()=>D.value?.id?.toString().startsWith("dev-"))),r((()=>{T(),B.isLoggedIn&&D.value&&H()})),l((()=>B.isLoggedIn),(e=>{e&&D.value?H():e||(E.value=!1)})),l((()=>A.params.id),((e,a)=>{e!==a&&T()}));const Q=()=>{if(!G.value)return k({message:"登录后即可点赞喵～",type:"warning",duration:2e3}),void W.push("/login");(async()=>{if(!G.value)return void k.warning("请先登录后再操作");const e=`user_${B.userId}_user-liked-prompts`,a=JSON.parse(localStorage.getItem(e)||"[]");E.value?await K(a,e):await F(a,e)})()};return(e,a)=>{const t=i("el-skeleton"),s=i("el-empty"),r=i("el-button"),l=i("el-tag");return o(),n("div",w,[M.value?(o(),u(t,{key:0,rows:10,animated:""})):D.value?(o(),n("div",J,[p("div",O,[p("div",$,[p("h2",null,v(D.value.title),1)]),c(l,{size:"default",type:(k=D.value.category,{"编程":"primary","写作":"success","设计":"warning","教育":"info","商业":"danger","通用":"info"}[k]||"info")},{default:d((()=>[f(v(D.value.category),1)])),_:1},8,["type"])]),p("div",x,[p("span",P,"作者: "+v(D.value.author),1),p("span",z,"发布于: "+v((y=D.value.created_at,new Date(y).toLocaleString("zh-CN"))),1)]),p("div",C,[p("pre",null,v(D.value.content),1)]),p("div",L,[c(r,{type:"primary",onClick:q},{default:d((()=>a[2]||(a[2]=[f("复制Prompt")]))),_:1,__:[2]}),c(r,{type:E.value?"warning":"success",icon:m(S),disabled:!1,class:g({"liked-button":E.value}),onClick:Q},{default:d((()=>[p("span",b,v(E.value?"取消点赞":"点赞"),1),p("span",j,v(D.value.likes),1)])),_:1},8,["type","icon","class"])])])):(o(),n("div",N,[c(s,{description:"未找到该Prompt"}),c(r,{type:"primary",onClick:a[0]||(a[0]=a=>e.$router.push("/prompts"))},{default:d((()=>a[1]||(a[1]=[f("返回列表")]))),_:1,__:[1]})]))]);var y,k}}},[["__scopeId","data-v-230a8e38"]]);export{A as default};
