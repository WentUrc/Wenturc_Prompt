import{az as e,r as t,c as a,k as l,S as r,X as o,ag as s,y as n,z as i,A as u,P as d,H as p,O as m,a4 as c,G as g,L as f}from"./vue-vendor-d5869c7e.js";import{a as v}from"./utils-9074b6ef.js";import{_ as y,u as h,g as b}from"./index-294d5dea.js";import{E as _}from"./element-plus-34fa3ae3.js";const w={class:"create-prompt"},P={class:"button-group"},V=y({__name:"CreatePrompt",setup(y){const V=e(),k=h(),x=t(null),j=t(!1),z=t(["编程","写作","设计","教育","商业","通用"]),L=t(window.innerWidth),q=a((()=>L.value<=768)),C=()=>{L.value=window.innerWidth};t(!1),l((async()=>{if(!k.isLoggedIn)return _.warning("请先登录后再创建Prompt"),void V.push("/login");window.addEventListener("resize",C)})),r((()=>{window.removeEventListener("resize",C)}));const I=o({title:"",category:"通用",content:""}),$={title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:3,max:100,message:"标题长度应在3到100个字符之间",trigger:"blur"}],category:[{required:!0,message:"请选择类别",trigger:"change"}],content:[{required:!0,message:"请输入Prompt内容",trigger:"blur"},{min:10,message:"内容长度不能少于10个字符",trigger:"blur"}]},E=async()=>{if(x.value)return k.isLoggedIn?void(await x.value.validate((async e=>{if(e){j.value=!0;try{const e={title:I.title.trim(),content:I.content.trim(),category:I.category};await v({method:"post",url:`${b()}/api/prompts`,headers:{Authorization:`Bearer ${k.token}`,"Content-Type":"application/json"},data:e,timeout:1e4,validateStatus:e=>e>=200&&e<300});U(),_.success("Prompt创建成功，正在审核中"),V.push("/prompts")}catch(t){if(t.response){if(401===t.response.status){try{if(await k.refreshTokenIfNeeded())return void _.info("会话已更新，请重试")}catch(a){}return _.error("登录状态已过期，请重新登录"),k.logout(),void V.push("/login")}_.error(`创建失败: ${t.response.data.msg||"服务器错误"}`)}else t.request?_.error("服务器未响应，请检查网络连接或后端服务状态"):_.error(`请求出错: ${t.message}`)}finally{j.value=!1}}}))):(_.warning("请先登录后再创建Prompt"),void V.push("/login"))},U=()=>{x.value&&x.value.resetFields()};return(e,t)=>{const a=s("el-input"),l=s("el-form-item"),r=s("el-option"),o=s("el-select"),v=s("el-button"),y=s("el-form");return n(),i("div",w,[t[5]||(t[5]=u("h2",null,"创建新Prompt",-1)),d(y,{model:I,rules:$,ref_key:"promptFormRef",ref:x,"label-width":q.value?"0px":"100px","label-position":q.value?"top":"left"},{default:p((()=>[d(l,{label:"标题",prop:"title"},{default:p((()=>[d(a,{modelValue:I.title,"onUpdate:modelValue":t[0]||(t[0]=e=>I.title=e),placeholder:"请输入Prompt标题"},null,8,["modelValue"])])),_:1}),d(l,{label:"类别",prop:"category"},{default:p((()=>[d(o,{modelValue:I.category,"onUpdate:modelValue":t[1]||(t[1]=e=>I.category=e),placeholder:"选择类别"},{default:p((()=>[(n(!0),i(m,null,c(z.value,(e=>(n(),g(r,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(l,{label:"内容",prop:"content"},{default:p((()=>[d(a,{modelValue:I.content,"onUpdate:modelValue":t[2]||(t[2]=e=>I.content=e),type:"textarea",rows:10,placeholder:"请输入Prompt内容"},null,8,["modelValue"])])),_:1}),d(l,null,{default:p((()=>[u("div",P,[d(v,{type:"primary",onClick:E,loading:j.value,class:"submit-button"},{default:p((()=>t[3]||(t[3]=[f("发布")]))),_:1,__:[3]},8,["loading"]),d(v,{onClick:U,class:"reset-button"},{default:p((()=>t[4]||(t[4]=[f("重置")]))),_:1,__:[4]})])])),_:1})])),_:1},8,["model","label-width","label-position"])])}}},[["__scopeId","data-v-aaa7761c"]]);export{V as default};
