import{r as e,k as a,ag as t,y as l,z as s,aB as r,K as o,P as n,H as i,C as d,A as c,M as p,L as u,G as v,u as m,T as y,f as g,O as f,a4 as k,V as h,D as w}from"./vue-vendor-d5869c7e.js";import{a as _}from"./utils-9074b6ef.js";import{v as x,k as b,E as P,l as $,o as I}from"./element-plus-34fa3ae3.js";import{_ as A,g as L,u as E}from"./index-294d5dea.js";const z={key:0,class:"card-skeleton-content"},j={class:"card-header"},D={class:"prompt-title"},V={class:"card-content"},C={class:"prompt-preview"},J={class:"card-meta"},S={class:"author"},N={class:"created-at"},O={class:"card-actions"},T={class:"likes"},B={class:"like-count"},M=A({__name:"PromptCard",props:{prompt:{type:Object,required:!0},loadingDelay:{type:Number,default:0}},emits:["like","external-detail"],setup(g,{emit:f}){const k=g,h=f,w=e(!0),_=e(!0);a((()=>{setTimeout((()=>{_.value=!1,setTimeout((()=>{w.value=!1}),100)}),k.loadingDelay)}));const P=e=>{if(!e)return"";return new Date(e).toLocaleDateString("zh-CN")},$=()=>{h("like",k.prompt)},I=()=>{h("external-detail",k.prompt)},A=e=>{e.style.opacity="0",e.style.transform="scale(0.98)"},L=(e,a)=>{e.offsetHeight,e.style.transition="all 0.5s ease-out",e.style.opacity="1",e.style.transform="scale(1)",setTimeout((()=>{a()}),500)},E=e=>{e.style.transition=""};return(e,a)=>{const f=t("el-tag"),k=t("el-icon"),h=t("el-button"),M=t("router-link");return l(),s("div",{class:d(["prompt-card-wrapper",{"card-loading":w.value,"card-loaded":!w.value,"card-skeleton":_.value}])},[_.value?(l(),s("div",z,a[0]||(a[0]=[r('<div class="skeleton-header" data-v-c8f0da9d><div class="skeleton-title" data-v-c8f0da9d></div><div class="skeleton-tag" data-v-c8f0da9d></div></div><div class="skeleton-body" data-v-c8f0da9d><div class="skeleton-line" data-v-c8f0da9d></div><div class="skeleton-line" data-v-c8f0da9d></div><div class="skeleton-line short" data-v-c8f0da9d></div><div class="skeleton-meta" data-v-c8f0da9d><div class="skeleton-author" data-v-c8f0da9d></div><div class="skeleton-date" data-v-c8f0da9d></div></div><div class="skeleton-actions" data-v-c8f0da9d><div class="skeleton-button primary" data-v-c8f0da9d></div><div class="skeleton-button" data-v-c8f0da9d></div></div></div>',2)]))):o("",!0),n(y,{name:"card-fade-in",appear:"",onBeforeEnter:A,onEnter:L,onAfterEnter:E},{default:i((()=>{return[_.value?o("",!0):(l(),s("div",{key:0,class:d(["prompt-card",{"card-enter-active":!w.value}])},[c("div",j,[c("span",D,p(g.prompt.title),1),n(f,{size:"small",type:(t=g.prompt.category,{"编程":"primary","写作":"success","设计":"warning","教育":"info","商业":"danger","通用":"info"}[t]||"info")},{default:i((()=>[u(p(g.prompt.category),1)])),_:1},8,["type"])]),c("div",V,[c("p",C,p((e=g.prompt.content,e?e.length>100?e.substring(0,100)+"...":e:"")),1),c("div",J,[c("span",S,"作者: "+p(g.prompt.author),1),c("span",N,p(P(g.prompt.created_at)),1)]),c("div",O,[g.prompt.isExternal?(l(),v(h,{key:1,type:"primary",size:"small",class:"detail-btn",onClick:I},{default:i((()=>[n(k,null,{default:i((()=>[n(m(x))])),_:1}),a[2]||(a[2]=c("span",null,"查看详情",-1))])),_:1,__:[2]})):(l(),v(M,{key:0,to:`/prompts/${g.prompt.id}`,class:"router-link"},{default:i((()=>[n(h,{type:"primary",size:"small",class:"detail-btn"},{default:i((()=>[n(k,null,{default:i((()=>[n(m(x))])),_:1}),a[1]||(a[1]=c("span",null,"查看详情",-1))])),_:1,__:[1]})])),_:1},8,["to"])),c("div",T,[n(h,{link:"",icon:m(b),onClick:$,class:d([{liked:g.prompt.hasLiked},"like-btn"])},{default:i((()=>[c("span",B,p(g.prompt.likes||0),1)])),_:1},8,["icon","class"])])])])],2))];var e,t})),_:1})],2)}}},[["__scopeId","data-v-c8f0da9d"]]),U={key:1,class:"error-state"},W={key:2,class:"external-prompt-content"},H={class:"prompt-header"},q={class:"meta-info"},G={class:"author"},K={class:"date"},F={key:0,class:"prompt-description"},Q={class:"prompt-content"},R={class:"content-box"},X={key:1,class:"prompt-stats"},Y={class:"dialog-footer"},Z=A({__name:"ExternalPromptModal",props:{modelValue:{type:Boolean,default:!1},prompt:{type:Object,default:null}},emits:["update:modelValue"],setup(a,{emit:r}){const d=a,m=r,y=e(!1),f=e(!1),k=e(null);g((()=>d.modelValue),(e=>{y.value=e,e&&d.prompt&&h()})),g(y,(e=>{m("update:modelValue",e)}));const h=async()=>{if(d.prompt?.id){f.value=!0;try{const e=L(),a=Number(d.prompt.id);if(isNaN(a))throw new Error("无效的Prompt ID格式");const t=await _.get(`${e}/api/external/prompts/${a}`);if(!t.data)throw new Error("外部API返回的数据格式不正确");k.value={...t.data,author:t.data.owner?.username||t.data.author||"未知作者",category:t.data.category||"通用"}}catch(e){P.error("获取外部Prompt详情失败，请稍后重试"),k.value=null}finally{f.value=!1}}else P.error("无效的Prompt ID")},w=async()=>{if(k.value?.content)try{await navigator.clipboard.writeText(k.value.content),P.success("内容已复制到剪贴板")}catch(e){P.error("复制失败，请手动复制")}else P.warning("没有可复制的内容")},x=()=>{y.value=!1,setTimeout((()=>{k.value=null}),300)},b=e=>{if(!e)return"未知";return new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})};return(e,r)=>{const d=t("el-skeleton"),m=t("el-empty"),g=t("el-alert"),h=t("el-tag"),_=t("el-statistic"),P=t("el-button"),$=t("el-dialog");return l(),v($,{modelValue:y.value,"onUpdate:modelValue":r[0]||(r[0]=e=>y.value=e),title:a.prompt?.title||"外部Prompt详情",width:"undefined"!=typeof window?window.innerWidth<=360?"95%":window.innerWidth<=768?"90%":"80%":"80%","before-close":x,class:"external-prompt-modal"},{footer:i((()=>[c("div",Y,[n(P,{onClick:x},{default:i((()=>r[4]||(r[4]=[u("关闭")]))),_:1,__:[4]}),n(P,{type:"primary",onClick:w,disabled:!k.value},{default:i((()=>r[5]||(r[5]=[u(" 复制内容 ")]))),_:1,__:[5]},8,["disabled"])])])),default:i((()=>{return[f.value?(l(),v(d,{key:0,rows:8,animated:""})):k.value?(l(),s("div",W,[n(g,{title:"外部内容提示",type:"info",closable:!1,"show-icon":"",class:"external-notice"},{default:i((()=>r[1]||(r[1]=[c("p",null,"以下内容来自外部网站，仅供参考学习使用",-1),c("p",null,[c("strong",null,"数据来源："),u("Jason的prompt市场")],-1)]))),_:1}),c("div",H,[c("h3",null,p(k.value.title),1),c("div",q,[n(h,{type:(e=k.value.category,{"编程":"primary","写作":"success","设计":"warning","教育":"info","商业":"danger","通用":"info"}[e]||"info"),size:"default"},{default:i((()=>[u(p(k.value.category),1)])),_:1},8,["type"]),c("span",G,"作者: "+p(k.value.author||k.value.owner?.username||"未知作者"),1),c("span",K,"创建时间: "+p(b(k.value.created_at)),1)])]),k.value.description?(l(),s("div",F,[r[2]||(r[2]=c("h4",null,"描述",-1)),c("p",null,p(k.value.description),1)])):o("",!0),c("div",Q,[r[3]||(r[3]=c("h4",null,"Prompt内容",-1)),c("div",R,[c("pre",null,p(k.value.content),1)])]),void 0!==k.value.likes?(l(),s("div",X,[n(_,{title:"点赞数",value:k.value.likes},null,8,["value"])])):o("",!0)])):(l(),s("div",U,[n(m,{description:"获取外部Prompt详情失败"})]))];var e})),_:1},8,["modelValue","title","width"])}}},[["__scopeId","data-v-57d0f73d"]]),ee={async getPrompts(e=0,a=1e3){try{const t=await fetch(`${L()}/api/external/prompts?skip=${e}&limit=${a}`);return{success:!0,data:await t.json()}}catch(t){return{success:!1,error:t.message}}},async getPromptsDirectly(e=0,a=1e3){try{const t=await fetch(`https://www.jasongjz.top/api/v1/prompts/?skip=${e}&limit=${a}`);return{success:!0,data:await t.json()}}catch(t){return{success:!1,error:t.message}}},async getAllPrompts(){try{let e=[],a=0;const t=100;let l=!0;for(;l;){const s=await this.getPrompts(a,t);if(!s.success||!Array.isArray(s.data))throw new Error(s.error||"分页获取失败");e=e.concat(s.data),s.data.length<t?l=!1:a+=t}return{success:!0,prompts:e,total:e.length}}catch(e){return{success:!1,error:e.message}}}},ae={class:"prompt-list"},te={class:"list-header"},le={class:"filter-actions"},se={key:1,class:"empty-state"},re={key:2,class:"prompt-grid"},oe={class:"section-header external-section"},ne={class:"external-header"},ie={class:"external-title-group"},de={key:4,class:"empty-state external-empty"},ce={key:5,class:"prompt-grid external-grid"},pe={class:"section-header external-section"},ue={class:"external-header"},ve={class:"external-title-group"},me={key:7,class:"empty-state external-empty"},ye={key:8,class:"prompt-grid external-grid"},ge="user-liked-prompts",fe=A({__name:"PromptList",setup(r){const o=E(),d=e([]),p=e([]),y=e([]),g=e(!1),x=e(!1),b=e(!1),A=e(""),z=e(["编程","写作","设计","教育","商业","通用"]),j=e(!1),D=e(null);e(!0);const V=e([]),C=async()=>{g.value=!0;try{const a=JSON.parse(localStorage.getItem("dev-prompts")||"[]");try{const e=`${L()}/api/prompts${A.value?`?category=${A.value}`:""}`,t=await _.get(e);if(!t.data||!Array.isArray(t.data))throw new Error("API返回的数据格式不正确");{const e=[...t.data,...a];e.sort(((e,a)=>new Date(a.created_at)-new Date(e.created_at))),A.value?d.value=e.filter((e=>e.category===A.value)):d.value=e}}catch(e){A.value?d.value=a.filter((e=>e.category===A.value)):d.value=a}J()}catch(e){P.error("获取数据失败，请稍后重试"),d.value=[]}finally{g.value=!1}},J=()=>{o.isLoggedIn&&0!==d.value.length&&d.value.forEach((e=>{e.hasLiked=V.value.includes(e.id)}))},S=()=>{if(o.isLoggedIn){const e=`user_${o.userId}_${ge}`;localStorage.setItem(e,JSON.stringify(V.value))}},N=e=>{P.info("外部网站的Prompt暂不支持点赞操作")},O=e=>{P.info("这是来自vmoranv市场的Prompt，请访问原网站查看完整内容")},T=e=>{D.value=e,j.value=!0},B=()=>{window.open("http://www.jasongjz.top/","_blank")},U=()=>{window.open("https://prompt.614447.xyz/","_blank")},W=async e=>{if(!o.isLoggedIn)return void P.warning("请先登录后再点赞");const a=e.id,t=e.hasLiked;if(a.toString().startsWith("dev-")){const e=JSON.parse(localStorage.getItem("dev-prompts")||"[]"),l=e.findIndex((e=>e.id===a));if(-1===l)return void P.error("未找到该Prompt");t?(e[l].likes=Math.max(0,e[l].likes-1),V.value=V.value.filter((e=>e!==a))):(e[l].likes+=1,V.value.includes(a)||V.value.push(a)),localStorage.setItem("dev-prompts",JSON.stringify(e));const s=d.value.findIndex((e=>e.id===a));return-1!==s&&(d.value[s].likes=e[l].likes,d.value[s].hasLiked=!t),S(),void P.success(t?"已取消点赞":"点赞成功")}try{let e;t?(e=await _.delete(`${L()}/api/prompts/${a}/like`,{headers:{Authorization:`Bearer ${o.token}`}}),V.value=V.value.filter((e=>e!==a))):(e=await _.post(`${L()}/api/prompts/${a}/like`,{},{headers:{Authorization:`Bearer ${o.token}`}}),V.value.includes(a)||V.value.push(a));const l=d.value.findIndex((e=>e.id===a));-1!==l&&(d.value[l].likes=e.data.likes,d.value[l].hasLiked=!t),S(),P.success(t?"已取消点赞":"点赞成功")}catch(l){P.error(t?"取消点赞失败，请稍后重试":"点赞失败，请稍后重试")}};return a((()=>{(()=>{if(o.isLoggedIn){const e=`user_${o.userId}_${ge}`,a=JSON.parse(localStorage.getItem(e)||"[]");V.value=a}})(),C(),(async()=>{x.value=!0;try{const e=await ee.getAllPrompts();if(!e.success)throw new Error(e.error||"Jason市场API返回错误");p.value=e.prompts.map((e=>({...e,category:e.category||"通用",content:e.content,title:e.title,description:e.description||e.content?.substring(0,100)+"...",likes:e.likes||0,created_at:e.created_at,author:e.owner?.username||e.author||"未知作者",isExternal:!0,source:"Jason的市场",hasLiked:!1})))}catch(e){try{const e=await ee.getPrompts(0,1e3);if(!e.success)throw new Error(e.error||"备用API也失败了");p.value=Array.isArray(e.data)?e.data.map((e=>({...e,category:e.category||"通用",content:e.content,title:e.title,description:e.description||e.content?.substring(0,100)+"...",likes:e.likes||0,created_at:e.created_at,author:e.owner?.username||e.author||"未知作者",isExternal:!0,source:"Jason的市场",hasLiked:!1}))):[],P.info(`通过分页方式获取了${p.value.length}个Jason市场的prompt`)}catch(a){p.value=[],P.warning("暂时无法获取Jason市场数据，请稍后重试")}}finally{x.value=!1}})(),(async()=>{b.value=!0;try{const e=L(),a=await _.get(`${e}/api/vmoranv/prompts`),t=Array.isArray(a.data)?a.data:a.data?.data&&Array.isArray(a.data.data)?a.data.data:[];y.value=t.map((e=>({id:e._id||e.id,category:e.tags?.[0]||e.category||"通用",content:e.content,title:e.title,description:e.content?.substring(0,100)+"...",likes:e.likesCount||e.likes||0,created_at:e.createdAt||e.created_at,author:e.author?.name||e.author||"未知作者",isExternal:!0,source:"vmoranv市场",hasLiked:!1,originalData:e})))}catch(e){y.value=[]}finally{b.value=!1}})()})),(e,a)=>{const r=t("el-option"),o=t("el-select"),_=t("el-skeleton"),P=t("el-empty"),L=t("el-icon"),E=t("el-tag");return l(),s("div",ae,[c("div",te,[a[2]||(a[2]=c("h2",null,"浏览Prompts",-1)),c("div",le,[n(o,{modelValue:A.value,"onUpdate:modelValue":a[0]||(a[0]=e=>A.value=e),placeholder:"选择类别",onChange:C},{default:i((()=>[n(r,{label:"全部",value:""}),(l(!0),s(f,null,k(z.value,(e=>(l(),v(r,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),a[9]||(a[9]=c("div",{class:"section-header"},[c("h3",null,"本站精选")],-1)),g.value?(l(),v(_,{key:0,rows:6,animated:""})):0===d.value.length?(l(),s("div",se,[n(P,{description:"暂无Prompt数据"})])):(l(),s("div",re,[(l(!0),s(f,null,k(d.value,((e,a)=>(l(),v(M,{key:e.id,prompt:e,"loading-delay":150*a,onLike:W,class:"prompt-card-item",style:w({"--card-index":a})},null,8,["prompt","loading-delay","style"])))),128))])),c("div",oe,[c("div",ne,[c("div",ie,[c("h3",null,[c("a",{href:"https://www.jasongjz.top",target:"_blank",class:"external-link",onClick:h(B,["prevent"])},[a[3]||(a[3]=u(" 来自Jason的prompt市场 ")),n(L,{class:"link-icon"},{default:i((()=>[n(m($))])),_:1})])]),n(E,{size:"small",type:"warning",effect:"plain",class:"external-tag"},{default:i((()=>[n(L,{class:"tag-icon"},{default:i((()=>[n(m(I))])),_:1}),a[4]||(a[4]=u(" 外部来源 "))])),_:1,__:[4]})])]),a[5]||(a[5]=c("p",{class:"section-description"},"以下内容来自Jason的prompt市场，仅供参考",-1))]),x.value?(l(),v(_,{key:3,rows:4,animated:"",class:"external-skeleton"})):0===p.value.length?(l(),s("div",de,[n(P,{description:"暂无外部Prompt数据"})])):(l(),s("div",ce,[(l(!0),s(f,null,k(p.value,((e,a)=>(l(),v(M,{key:`external-${e.id}`,prompt:e,"loading-delay":100*a,onLike:N,onExternalDetail:T,class:"prompt-card-item external-card",style:w({"--card-index":a})},null,8,["prompt","loading-delay","style"])))),128))])),c("div",pe,[c("div",ue,[c("div",ve,[c("h3",null,[c("a",{href:"https://prompt.614447.xyz/",target:"_blank",class:"external-link",onClick:h(U,["prevent"])},[a[6]||(a[6]=u(" 来自vmoranv的prompt市场 ")),n(L,{class:"link-icon"},{default:i((()=>[n(m($))])),_:1})])]),n(E,{size:"small",type:"success",effect:"plain",class:"external-tag"},{default:i((()=>[n(L,{class:"tag-icon"},{default:i((()=>[n(m(I))])),_:1}),a[7]||(a[7]=u(" 外部来源 "))])),_:1,__:[7]})])]),a[8]||(a[8]=c("p",{class:"section-description"},"以下内容来自vmoranv的prompt市场，仅供参考",-1))]),b.value?(l(),v(_,{key:6,rows:4,animated:"",class:"external-skeleton"})):0===y.value.length?(l(),s("div",me,[n(P,{description:"暂无vmoranv市场Prompt数据"})])):(l(),s("div",ye,[(l(!0),s(f,null,k(y.value,((e,a)=>(l(),v(M,{key:`vmoranv-${e.id}`,prompt:e,"loading-delay":100*a,onLike:N,onClick:O,class:"prompt-card-item external-card",style:w({"--card-index":a})},null,8,["prompt","loading-delay","style"])))),128))])),n(Z,{modelValue:j.value,"onUpdate:modelValue":a[1]||(a[1]=e=>j.value=e),prompt:D.value},null,8,["modelValue","prompt"])])}}},[["__scopeId","data-v-2a212d2d"]]);export{fe as default};
